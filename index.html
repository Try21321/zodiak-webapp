<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ì–æ—Ä–æ—Å–∫–æ–ø ‚Äî Telegram WebApp</title>
  <meta name="description" content="–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ Telegram WebApp: –≤—ã–±–µ—Ä–∏ –∑–Ω–∞–∫ –∏ —á–∏—Ç–∞–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞ –∏ –Ω–µ–¥–µ–ª—é." />
  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #0f1115;
      --card: #161a22;
      --text: #e6e8ee;
      --muted: #a2a8b3;
      --primary: #6aa0ff;
      --accent: #ffc46a;
      --ok: #2ecc71;
      --shadow: 0 10px 24px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell,
      Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--text);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .container { max-width: 980px; margin: 0 auto; padding: 20px; }
    header { display:flex; align-items:center; gap:12px; margin-bottom:16px; }
    .logo { width:40px; height:40px; display:grid; place-items:center; background:var(--card); border-radius:12px; box-shadow: var(--shadow); }
    .title { font-weight: 800; letter-spacing:.2px; }
    .subtitle { color: var(--muted); font-size: 14px; }

    .grid { display:grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
    @media (max-width: 860px) { .grid { grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 520px) { .grid { grid-template-columns: repeat(3, 1fr); } }

    .card { background: var(--card); border-radius: var(--radius); padding: 12px; text-align:center; cursor:pointer; transition: transform .08s ease, background .15s ease; box-shadow: var(--shadow); }
    .card:hover { transform: translateY(-2px); }
    .card.active { outline: 2px solid var(--primary); background: #1a2130; }
    .sym { font-size: 24px; line-height:1; }
    .sign { font-size: 12px; color: var(--muted); margin-top: 6px; }

    .panel { margin-top: 16px; background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }
    .panel-head { display:flex; align-items:center; justify-content:space-between; padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,.06); }
    .panel-title { font-weight: 700; display:flex; align-items:center; gap:10px; }
    .chip { font-size: 12px; color: var(--muted); background: rgba(255,255,255,.06); padding:4px 8px; border-radius: 999px; }

    .tabs { display:flex; gap: 8px; padding: 12px 12px 0; flex-wrap: wrap; }
    .tab { border: 1px solid rgba(255,255,255,.08); background: transparent; color: var(--text); padding: 8px 12px; border-radius: 10px; cursor:pointer; font-weight:600; }
    .tab.active { background: var(--primary); border-color: var(--primary); color:#0b1220; }

    .content { padding: 12px 16px 16px; }
    .text { color: var(--text); line-height: 1.55; white-space: pre-wrap; }
    .muted { color: var(--muted); }

    .bar { display:flex; align-items:center; gap: 10px; padding: 8px 12px; background: #121620; border-radius: 12px; margin: 12px 16px; }
    .bar input[type="search"] { flex:1; background: transparent; border: 0; color: var(--text); font-size: 14px; outline: none; }

    .footer { text-align:center; color: var(--muted); font-size: 12px; margin: 18px 0 40px; }
    .link { color: var(--primary); text-decoration: none; }
    .err { color: #ff8a8a; font-size: 13px; padding: 8px 12px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">üîÆ</div>
      <div>
        <div class="title">–ì–æ—Ä–æ—Å–∫–æ–ø</div>
        <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ –∏ –¥–µ–Ω—å ‚Äî –≤—Å—ë –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</div>
      </div>
    </header>

    <div class="bar">
      <span class="muted">üîé</span>
      <input id="search" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–Ω–∞–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: –í–µ—Å—ã, Libra)" />
    </div>

    <section id="signs" class="grid" aria-label="–ó–Ω–∞–∫–∏ –∑–æ–¥–∏–∞–∫–∞"></section>

    <section id="panel" class="panel" hidden>
      <div class="panel-head">
        <div class="panel-title"><span id="panel-emoji" class="sym"></span><span id="panel-name"></span></div>
        <span id="panel-date" class="chip"></span>
      </div>
      <div class="tabs">
        <button class="tab" data-range="today">–°–µ–≥–æ–¥–Ω—è</button>
        <button class="tab" data-range="tomorrow">–ó–∞–≤—Ç—Ä–∞</button>
        <button class="tab" data-range="week">–ù–µ–¥–µ–ª—è</button>
      </div>
      <div class="content">
        <div id="text" class="text"></div>
        <div id="hint" class="muted" style="margin-top:10px"></div>
        <div id="error" class="err" hidden></div>
      </div>
    </section>

    <div class="footer">
      –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –≤–Ω–µ Telegram: WebApp —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–µ–º–∞, –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏) —Å–∫—Ä—ã—Ç—ã. <a class="link" href="#" id="reset">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</a>
    </div>
  </div>

  <script>
    // ====== –ì–õ–û–ë–ê–õ–¨–ù–´–ï ======
    let DATA = {};               // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ fetch('horoscope_ru.json')
    let ORDER = [];              // –ü–æ—Ä—è–¥–æ–∫ –∑–Ω–∞–∫–æ–≤ –∏–∑ DATA
    const $signs = document.getElementById('signs');
    const $panel = document.getElementById('panel');
    const $panelEmoji = document.getElementById('panel-emoji');
    const $panelName = document.getElementById('panel-name');
    const $panelDate = document.getElementById('panel-date');
    const $text = document.getElementById('text');
    const $hint = document.getElementById('hint');
    const $search = document.getElementById('search');
    const $error = document.getElementById('error');

    let current = { sign: null, range: 'today' };

    // ====== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ======
    async function loadData() {
      try {
        const res = await fetch('horoscope_ru.json', { cache: 'no-cache' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        DATA = await res.json();

        // –ü—Ä–∏–≤–æ–¥–∏–º —Ñ–æ—Ä–º–∞—Ç: –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ –≤ JSON –∫–∞–∂–¥—ã–π –∑–Ω–∞–∫ ‚Äî –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏:
        // { emoji, ru, en, today, tomorrow, week }
        // –ï—Å–ª–∏ —Ç–≤–æ—ë –∏–º—è –ø–æ–ª—è "weekly" ‚Äî –æ—Ç—Ä–∞–∑–∏–º –≤ "week".
        for (const key of Object.keys(DATA)) {
          const s = DATA[key] || {};
          if (!s.week && s.weekly) s.week = s.weekly;
        }

        ORDER = Object.keys(DATA);
        init();
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ horoscope_ru.json:', e);
        $error.hidden = false;
        $error.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª horoscope_ru.json –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º —Å index.html –∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ —á–µ—Ä–µ–∑ http/https (–Ω–µ file://).';
      }
    }

    // ====== –†–ï–ù–î–ï–† –°–ï–¢–ö–ò –ó–ù–ê–ö–û–í ======
    function renderGrid(filter = '') {
      const q = filter.trim().toLowerCase();
      $signs.innerHTML = '';
      ORDER.forEach((key) => {
        const s = DATA[key];
        if (!s) return;
        const hay = `${s.ru || ''} ${s.en || ''} ${key}`.toLowerCase();
        if (q && !hay.includes(q)) return;

        const card = document.createElement('button');
        card.className = 'card';
        card.dataset.key = key;
        card.innerHTML = `<div class="sym">${s.emoji || '‚ú®'}</div><div class="sign">${(s.ru || key)} / ${(s.en || key)}</div>`;
        card.addEventListener('click', () => selectSign(key));
        $signs.appendChild(card);
      });

      // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å
      if (!$signs.children.length) {
        const empty = document.createElement('div');
        empty.className = 'muted';
        empty.style.gridColumn = '1 / -1';
        empty.style.padding = '8px 4px';
        empty.textContent = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
        $signs.appendChild(empty);
      }
    }

    $search.addEventListener('input', (e) => renderGrid(e.target.value));

    // ====== –í–´–ë–û–† –ó–ù–ê–ö–ê –ò –¢–ê–ë–û–í ======
    function selectSign(key) {
      current.sign = key;
      localStorage.setItem('zodiac:selected', key);
      updatePanel();
      window.scrollTo({ top: document.querySelector('#panel').offsetTop - 8, behavior: 'smooth' });
    }

    function selectRange(range) {
      current.range = range;
      localStorage.setItem('zodiac:range', range);
      updatePanel();
    }

    function updatePanel() {
      // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
      document.querySelectorAll('.card').forEach(c => c.classList.toggle('active', c.dataset.key === current.sign));

      if (!current.sign || !DATA[current.sign]) { $panel.hidden = true; return; }
      const s = DATA[current.sign];
      $panel.hidden = false;

      // –∑–∞–≥–æ–ª–æ–≤–æ–∫
      $panelEmoji.textContent = s.emoji || '‚ú®';
      $panelName.textContent = `${s.ru || current.sign} / ${s.en || current.sign}`;

      // –¥–∞—Ç–∞
      const now = new Date();
      const fmt = d => d.toLocaleDateString(undefined, { day:'2-digit', month:'short' });
      let label = '';
      if (current.range === 'today') label = `–°–µ–≥–æ–¥–Ω—è ‚Ä¢ ${fmt(now)}`;
      else if (current.range === 'tomorrow') label = `–ó–∞–≤—Ç—Ä–∞ ‚Ä¢ ${fmt(new Date(now.getTime() + 86400000))}`;
      else {
        const end = new Date(now.getTime() + 6 * 86400000);
        label = `–ù–µ–¥–µ–ª—è ‚Ä¢ ${fmt(now)} ‚Äî ${fmt(end)}`;
      }
      $panelDate.textContent = label;

      // —Ç–∞–±—ã
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.range === current.range));

      // —Ç–µ–∫—Å—Ç
      const content = s[current.range] || '–¢–µ–∫—Å—Ç –Ω–µ –∑–∞–¥–∞–Ω.';
      $text.textContent = content;
      $hint.textContent = '–°–æ–≤–µ—Ç: –¥–æ–±–∞–≤—å—Ç–µ –≤ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É –≤ –±–æ—Ç–µ.';

      // Telegram MainButton
      if (window.Telegram && window.Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
        const app = Telegram.WebApp;
        app.MainButton.setText(`–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è: ${(s.ru || current.sign)} ‚Äî ${label}`);
        app.MainButton.show();
        app.MainButton.onClick(() => {
          app.sendData(JSON.stringify({ action: 'subscribe', sign: current.sign, range: current.range }));
          app.HapticFeedback.impactOccurred('medium');
        });
      }
    }

    document.querySelectorAll('.tab').forEach(btn => btn.addEventListener('click', () => selectRange(btn.dataset.range)));

    // ====== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ======
    function init() {
      // –ø–æ—Ä—è–¥–æ–∫ –∑–Ω–∞–∫–æ–≤ —Ñ–∏–∫—Å–∏—Ä—É–µ–º, –Ω–æ –µ—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è ‚Äî –º–æ–∂–Ω–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
      // ORDER = ['aries','taurus','gemini','cancer','leo','virgo','libra','scorpio','sagittarius','capricorn','aquarius','pisces'];

      renderGrid();

      // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±–æ—Ä
      const savedSign = localStorage.getItem('zodiac:selected');
      const savedRange = localStorage.getItem('zodiac:range');
      if (savedSign && DATA[savedSign]) current.sign = savedSign;
      if (savedRange) current.range = savedRange;
      updatePanel();

      // Telegram –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
      if (window.Telegram && window.Telegram.WebApp) {
        const app = Telegram.WebApp;
        app.expand();
        document.documentElement.style.setProperty('--bg', app.themeParams.bg_color || getComputedStyle(document.documentElement).getPropertyValue('--bg'));
        document.documentElement.style.setProperty('--card', app.themeParams.secondary_bg_color || getComputedStyle(document.documentElement).getPropertyValue('--card'));
        document.documentElement.style.setProperty('--text', app.themeParams.text_color || getComputedStyle(document.documentElement).getPropertyValue('--text'));
        document.documentElement.style.setProperty('--muted', app.themeParams.hint_color || getComputedStyle(document.documentElement).getPropertyValue('--muted'));
        document.documentElement.style.setProperty('--primary', app.themeParams.button_color || getComputedStyle(document.documentElement).getPropertyValue('--primary'));
      }
    }

    // –°–±—Ä–æ—Å
    document.getElementById('reset').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('zodiac:selected');
      localStorage.removeItem('zodiac:range');
      current = { sign: null, range: 'today' };
      updatePanel();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // –°—Ç–∞—Ä—Ç
    loadData();
  </script>
</body>
</html>




